<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="这是一个采用Enitas框架，用unity制作的roguelike类2D游戏，旨在学习roguelike类游戏制作开发。"><title>UniRx-学习[2]--存储层次数据 | DungeonsGame</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="../../../../css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="../../../../favicon.ico"><link rel="apple-touch-icon" href="../../../../apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="../../../../apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">UniRx-学习[2]--存储层次数据</h1><a id="logo" href="../../../../.">DungeonsGame</a><p class="description">记录制作的roguelike2D游戏过程。</p></div><div id="nav-menu"><a href="../../../../." class="current"><i class="fa fa-home"> 首页</i></a><a href="../../../../archives/"><i class="fa fa-archive"> 归档</i></a><a href="../../../../about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">UniRx-学习[2]--存储层次数据</h1><div class="post-meta">Nov 7, 2016<span> | </span><span class="category"><a href="../../../../categories/程序/">程序</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h2 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h2><p>数据结构样式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">        (ROOT)</div><div class="line">      /        \</div><div class="line">    Dir2      Dir3</div><div class="line">    /    \        \</div><div class="line">  Dir4 Dir5        Dir6</div><div class="line">  /          </div><div class="line">Dir7</div></pre></td></tr></table></figure></p>
<p>创建表：filesystem</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>dirName</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Root</td>
</tr>
<tr>
<td>2</td>
<td>Dir2</td>
</tr>
<tr>
<td>3</td>
<td>Dir3</td>
</tr>
<tr>
<td>4</td>
<td>Dir4</td>
</tr>
<tr>
<td>5</td>
<td>Dir5</td>
</tr>
<tr>
<td>6</td>
<td>Dir6</td>
</tr>
<tr>
<td>7</td>
<td>Dir7</td>
</tr>
</tbody>
</table>
<p>创建表：treePath</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>ancestor</th>
<th>descendant</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
<td>4</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>6</td>
<td>1</td>
<td>6</td>
</tr>
<tr>
<td>7</td>
<td>1</td>
<td>7</td>
</tr>
<tr>
<td>8</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>9</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>10</td>
<td>2</td>
<td>5</td>
</tr>
<tr>
<td>11</td>
<td>2</td>
<td>7</td>
</tr>
<tr>
<td>12</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>13</td>
<td>3</td>
<td>6</td>
</tr>
<tr>
<td>14</td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td>15</td>
<td>4</td>
<td>7</td>
</tr>
<tr>
<td>16</td>
<td>5</td>
<td>5</td>
</tr>
<tr>
<td>17</td>
<td>6</td>
<td>6</td>
</tr>
<tr>
<td>18</td>
<td>7</td>
<td>7</td>
</tr>
</tbody>
</table>
<p>获取全部<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">void tt()</div><div class="line">&#123;</div><div class="line">    new DataService(&quot;tempDB.sqlite3&quot;);</div><div class="line">    dbPath = string.Format(@&quot;Assets/StreamingAssets/tempDB.sqlite3&quot;);</div><div class="line">    _connection = new SQLiteConnection(dbPath, SQLiteOpenFlags.ReadWrite | SQLiteOpenFlags.Create);</div><div class="line"></div><div class="line">    var files = _connection.Table&lt;Filesystem&gt;().ToObservable();</div><div class="line">    var treePath = _connection.Table&lt;TreePath&gt;();</div><div class="line">    var joine = files.SelectMany(x =&gt; treePath, (x, y) =&gt; new &#123;x, y&#125;)</div><div class="line">        .Where(t =&gt; t.x.Id == t.y.descendant)</div><div class="line">        .Where(t =&gt; t.y.ancestor == 1)</div><div class="line">        .Select(t =&gt; t.x.dirName);</div><div class="line">    joine.Do(x =&gt; Debug.Log(x))</div><div class="line">        .Subscribe();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果为：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>dirname</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>ROOT</td>
</tr>
<tr>
<td>2</td>
<td>Dir2</td>
</tr>
<tr>
<td>3</td>
<td>Dir3</td>
</tr>
<tr>
<td>4</td>
<td>Dir4</td>
</tr>
<tr>
<td>5</td>
<td>Dir5</td>
</tr>
<tr>
<td>6</td>
<td>Dir6</td>
</tr>
<tr>
<td>7</td>
<td>Dir7</td>
</tr>
</tbody>
</table>
<p><strong>当.Where(t =&gt; t.y.ancestor == 3)</strong><br>结果为：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>dirname</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>Dir3</td>
</tr>
<tr>
<td>6</td>
<td>Dir6</td>
</tr>
</tbody>
</table>
<h2 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h2><p>数据结构样式  </p>
<p><img src="http://shiningray.cn/wp-content/uploads/2006/04/sitepoint_numbering.gif" alt="">  </p>
<p>创建表：tree</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>parent</th>
<th>title</th>
<th>lft</th>
<th>rgt</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td></td>
<td>Food</td>
<td>1</td>
<td>18</td>
</tr>
<tr>
<td>2</td>
<td>Food</td>
<td>Fruit</td>
<td>2</td>
<td>11</td>
</tr>
<tr>
<td>3</td>
<td>Fruit</td>
<td>Red</td>
<td>3</td>
<td>6</td>
</tr>
<tr>
<td>4</td>
<td>Red</td>
<td>Cherry</td>
<td>4</td>
<td>5</td>
</tr>
<tr>
<td>5</td>
<td>Fruit</td>
<td>Yellow</td>
<td>7</td>
<td>10</td>
</tr>
<tr>
<td>6</td>
<td>Yellow</td>
<td>Banana</td>
<td>8</td>
<td>9</td>
</tr>
<tr>
<td>7</td>
<td>Food</td>
<td>Meat</td>
<td>12</td>
<td>17</td>
</tr>
<tr>
<td>8</td>
<td>Meat</td>
<td>Beef</td>
<td>13</td>
<td>14</td>
</tr>
<tr>
<td>9</td>
<td>Meat</td>
<td>Pork</td>
<td>15</td>
<td>16</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">var ii = _connection.Table&lt;Item&gt;();</div><div class="line">ii.ToObservable()</div><div class="line">   .Where(x=&gt;x.lft&gt;2&amp;&amp;x.lft&lt;11)</div><div class="line">   .Do(x =&gt; Debug.Log(x.ToString()))</div><div class="line">   .Subscribe();</div><div class="line"></div><div class="line">public class Item</div><div class="line">&#123;</div><div class="line">   [PrimaryKey,AutoIncrement]</div><div class="line">   public int Id &#123; get; set; &#125;</div><div class="line">   public string parent &#123; get; set; &#125;</div><div class="line">   public string title &#123; get; set; &#125;</div><div class="line">   public int lft &#123; get; set; &#125;</div><div class="line">   public int rgt &#123; get; set; &#125;</div><div class="line">   public override string ToString()</div><div class="line">   &#123;</div><div class="line">       return string.Format(&quot;[Item: parent=&#123;0&#125;, title=&#123;1&#125;,  lft=&#123;2&#125;, rgt=&#123;3&#125;]&quot;, parent, title, lft, rgt);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="方法3"><a href="#方法3" class="headerlink" title="方法3"></a>方法3</h2><p>确实没有想到sql做成树状结构会这么繁琐，我的想法是物理结构就是tables list，逻辑结构可以通过xml来管理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">                     runtime data                          config</div><div class="line">                                                  |</div><div class="line">Player                                            |</div><div class="line">  +---+World                                      |</div><div class="line">  |     +----+Le^el                               |</div><div class="line">  |     |      +---+grid1                         |</div><div class="line">  |     |      |     +---+curItems+-----------+   |</div><div class="line">  |     |      |     |                        |   |</div><div class="line">  |     |      |     +---+monster +-------------+ |</div><div class="line">  |     |      |     |                        | | |               +-+item</div><div class="line">  |     |      |     +---+room1,2,3...+-&gt;Xml  +----&gt;Items tables+-+</div><div class="line">  |     |      +---+grid2                     | | |               +-+equipment</div><div class="line">  |     |      |     +---+curItems+-----------+ | |</div><div class="line">  |     |      |     |                          +--&gt;Monster tables+-+player</div><div class="line">  |     |      |     +---+monster +-------------+ |               |</div><div class="line">  |     |      |     |                            |               +-+creature</div><div class="line">  |     |      |     +---+room1,2,3...+-&gt;Xml      |</div><div class="line">  |     |      +---+...                           |</div><div class="line">  |     +----+Fam                                 |</div><div class="line">  |                                               |</div><div class="line">  +---+Other                                      |</div><div class="line">                                                  |</div><div class="line">                                                  |</div><div class="line">                                                  |</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>多重流合并操作</strong><br><strong>CombineLatest</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">void Start()</div><div class="line">&#123;</div><div class="line">    var sourceA = Observable.Return(5);</div><div class="line">    var sourceB = Observable.Return(&quot;b&quot;);</div><div class="line">    var sourceC = Observable.Return(0.2f);</div><div class="line">    var joined =</div><div class="line">      Observable.CombineLatest(sourceA, sourceB, sourceC, (a, b, c) =&gt; new &#123;A = a, B = b, C = c&#125;)</div><div class="line">        .Do(t =&gt; Debug.Log(t.A + t.B + t.C))</div><div class="line">        .Subscribe();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Select</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">void Start()</div><div class="line">&#123;</div><div class="line">    var sourceA = Observable.Return(5);</div><div class="line">    var sourceB = Observable.Return(&quot;b&quot;);</div><div class="line">    var sourceC = Observable.Return(0.2f);</div><div class="line">    var query =</div><div class="line">        sourceA.Select(s1 =&gt; sourceB.Select(s2 =&gt; sourceC.Select(s3 =&gt; new &#123;s1, s2, s3&#125;)))</div><div class="line">            .Switch()</div><div class="line">            .SelectMany(t =&gt; t)</div><div class="line">            .Do(t =&gt; Debug.Log(t.s1 + t.s2 + t.s3))</div><div class="line">            .Subscribe();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Zip</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">void tt()</div><div class="line">&#123;</div><div class="line">    var aa = new string[] &#123;&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;&#125;;</div><div class="line">    var bb = new int[] &#123;1, 2, 3, 4, 5&#125;;</div><div class="line">    var cc = new float[] &#123;0.1f, 0.2f, 0.3f, 0.4f&#125;;</div><div class="line"></div><div class="line">    var a = aa.ToObservable();</div><div class="line">    var b = bb.ToObservable();</div><div class="line">    var c = cc.ToObservable();</div><div class="line"></div><div class="line">    a.Zip(b, (lhs, rhs) =&gt; new &#123;left = lhs, right = rhs,&#125;)</div><div class="line">        .Do(t =&gt; Debug.Log(t.left + t.right))</div><div class="line">        .Subscribe();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>subject</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">var streams = new Subject&lt;IObservable&lt;int&gt;&gt;();</div><div class="line">var mergedStreams = streams.Merge();</div><div class="line">var mergedObserver = mergedStreams.Subscribe(...);</div><div class="line"></div><div class="line">// now create your streams</div><div class="line">...</div><div class="line"></div><div class="line">// add them to the streams subject</div><div class="line">streams.OnNext(seq1);</div><div class="line">streams.OnNext(seq2);</div><div class="line">...</div><div class="line"></div><div class="line">streams.OnNext(seq3);</div><div class="line">streams.OnNext(seq4);</div><div class="line"></div><div class="line">...</div><div class="line">// If we know there will be no more streams, tell the Subject...</div><div class="line">streams.OnCompleted();</div></pre></td></tr></table></figure></p>
</div><div class="tags"><a href="../../../../tags/程序/">程序</a></div><div class="post-nav"><a href="../程序警言/" class="pre">程序警言</a><a href="../../06/UniRx-学习/" class="next">UniRx 学习</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://github.com/KuaileY/DungeonsGame"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/学习/">学习</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/程序/">程序</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/策划/">策划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/美术/">美术</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="../../../../tags/程序/" style="font-size: 15px;">程序</a> <a href="../../../../tags/策划/" style="font-size: 15px;">策划</a> <a href="../../../../tags/美术/" style="font-size: 15px;">美术</a> <a href="../../../../tags/git/" style="font-size: 15px;">git</a> <a href="../../../../tags/感悟/" style="font-size: 15px;">感悟</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="../../08/Sqlite4Unity学习/">Sqlite4Unity学习</a></li><li class="post-list-item"><a class="post-list-link" href="../程序警言/">程序警言</a></li><li class="post-list-item"><a class="post-list-link" href="">UniRx-学习[2]--存储层次数据</a></li><li class="post-list-item"><a class="post-list-link" href="../../06/UniRx-学习/">UniRx 学习</a></li><li class="post-list-item"><a class="post-list-link" href="../../04/顺利拿到一坑/">顺利拿到一坑</a></li><li class="post-list-item"><a class="post-list-link" href="../../04/翻译-game-data-and-Entitas/">[翻译]game,data and Entitas</a></li><li class="post-list-item"><a class="post-list-link" href="../../../10/14/makeMap/">地图测试</a></li><li class="post-list-item"><a class="post-list-link" href="../../../10/09/art-style/">美术风格</a></li><li class="post-list-item"><a class="post-list-link" href="../../../10/07/UX/">UX框架</a></li><li class="post-list-item"><a class="post-list-link" href="../../../10/05/githug/">githug</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://marklodato.github.io/visual-git-guide/index-zh-cn.html" title="图解Git" target="_blank">图解Git</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="../../../../." rel="nofollow">DungeonsGame.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="../../../../js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="../../../../js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="../../../../css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="../../../../js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="../../../../js/smartresize.js?v=0.0.0"></script></div></body></html>